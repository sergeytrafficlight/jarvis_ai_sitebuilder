<div class="modal-overlay" id="modal_edit_image" hidden>
  <div class="modal">
    <div class="modal-header">
      <h3>Редактирование изображения</h3>
      <button class="modal-close" data-close="#modal_edit_image">✕</button>
    </div>

    <div class="modal-body two-columns">
      <!-- Левая колонка: превью + действия -->
      <div class="modal-left" style="display:flex; flex-direction:column; gap:12px; min-width:0;">
        <div class="muted" id="imgMeta"></div>
        <div class="muted" id="imgSize">Размеры: — × —</div>

        <div style="display:flex; gap:12px; align-items:flex-start;">
            <img id="imgPreview" src="" alt="Выбранное изображение"
                 style="border-radius:8px; border:1px solid rgba(255,255,255,0.1);" />

        </div>

        <div class="card" style="padding:12px;">
          <strong>Замена с компьютера</strong>
          <div style="margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <input type="file" id="imgUploadFile" accept="image/*" />
            <button class="btn btn-primary" id="imgUploadBtn">Заменить</button>
          </div>
          <div class="muted" style="margin-top:6px;">Файл будет записан поверх текущего пути.</div>
        </div>

        <div class="card" style="padding:12px;">
          <strong>Замена по URL</strong>
          <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
            <input type="url" id="imgUrlInput" placeholder="https://..." style="flex:1;
                   background: rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.08);
                   border-radius:10px; padding:10px 12px; color:var(--text);" />
            <button class="btn btn-secondary" id="imgUrlBtn">Заменить</button>
          </div>
        </div>
      </div>

      <!-- Правая колонка: зона для AI-полей -->
        <div class="modal-right" style="display:flex; flex-direction:column;">
          <div style="display:flex; flex-direction:column; gap:10px; height:100%; min-height:0;">
            <label><strong>AI-промт для изображения</strong></label>
            <textarea id="imgAiNextPrompt" class="textarea" rows="4" placeholder="Опишите следующий запрос к ИИ..."></textarea>

            <!-- Пояснение показывается только при активных коммуникациях -->
            <div id="imgAiLockNotice" class="muted" style="display:none;">
              Отправка доступна, когда нет активных AI-коммуникаций
            </div>

            <button class="btn btn-primary" id="imgAiSendBtn" disabled style="width:100%;">Отправить в AI</button>

            <div style="margin-top:8px;"><strong>История</strong></div>
            <div id="imgAiHistory"
                 style="overflow:auto; border:1px solid rgba(255,255,255,0.08); border-radius:10px; padding:10px; min-height:120px; max-height:30vh;">
              <div class="muted">История пуста</div>
            </div>
          </div>
        </div>


    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" data-close="#modal_edit_image">Закрыть</button>
    </div>
  </div>
</div>



